function setupFullscreen(){var a=$("<div>").addClass("fullscreen-overlay loader-parent").click(function(){n()}).appendTo("body"),t=null;function n(){$("body").removeClass("has-fullscreen"),t=null}function e(e){var n=(t=e).find("img, video").first().clone(),e=e.find(".loading-spinner").clone();a.empty().append(n).append(e),n.is("video")&&(setTimeout(function(){a.addClass("loading")},10),n.on("canplay",function(){n.addClass("loaded"),a.addClass("loaded").removeClass("loading"),n.get(0).play()}),n.get(0).load()),setTimeout(function(){$("body").addClass("has-fullscreen")},10)}$(".page:not(.no-fullscreen) .media").click(function(){a.removeClass("loaded loading"),0<$(this).parents(".panning").length||e($(this))}),$(document).on("keydown",function(e){27==e.keyCode&&n()}),window.loadFullscreenMedia=e,window.getCurrentFullscreenMedia=function(){return t}}function setupKeyboardNav(){$(document).on("keydown",function(e){var n,a,t,i;37!=e.keyCode&&39!=e.keyCode||(n=37==e.keyCode?-1:1,$("body").hasClass("has-fullscreen")?!(e=getCurrentFullscreenMedia())||(e=e.parent(".page")[-1==n?"prev":"next"](".page:not(.no-fullscreen)")).length&&loadFullscreenMedia(e.find(".media")):(a=$(window).height(),t=null,i=0,$(".pages").each(function(){var e=$(this).get(0).getBoundingClientRect(),n=e.bottom-e.top,n=(Math.min(e.bottom,a)-Math.max(e.top,0))/n;i<n&&(t=this,i=n)}),t&&t.snapToPage&&t.snapToPage(t.getCurrentPage()+n)))})}function setupVideoMedia(){var e,n;function a(){playVideoMedia($(e),!0)}$(document).on("mouseenter",".page.video .media",function(){n&&(clearTimeout(n),n=0),e=this,n=setTimeout(a,100)}).on("mouseleave",".page.video .media",function(){n&&(clearTimeout(n),n=0),playVideoMedia($(this),!1)}).on("click",".page.video .media",function(){$(this).find("video").get(0).currentTime=0});var t=$("section.project:not(.was-visible)");function i(){var n=$(window).width(),a=$(window).height();t.each(function(){var e=$(this).get(0).getBoundingClientRect();e.bottom<0||e.right<0||e.left>n||e.top>a||($(this).addClass("was-visible"),t=$("section.project:not(.was-visible)"),loadPage($(this).find(".page").first()))})}i(),$(window).on("scroll resize",i)}function setupMediaSizing(){$(".media video").on("resize",function(){sizeMedia($(this).parents(".media"))}),$(".media img").on("load",function(){sizeMedia($(this).parents(".media"))})}function sizeMedia(e){var n,a,t,i,o=e.children().eq(0);o.length&&(e.parent(".page").hasClass("no-scale")||(i=1,i=(n=e.width())/(a=e.height())<(t=o.get(0).offsetWidth)/(e=o.get(0).offsetHeight)?n/t:a/e,i=Math.min(i,1),o.css("transform","scale("+i+")")))}function buildPagers(){var y,b,e,M;function n(){y=window.screen.width<480?16:32,b=16,e=$(".pages").width(),M=e-2*(y+b),$(".page").css({width:M,minWidth:M,marginRight:b}),$(".page:first-child").css({marginLeft:b+y}),$(".page:last-child").css({marginRight:y}),$(".media").each(function(){sizeMedia($(this))})}n(),$(window).resize(n),$(".pages").each(function(){var t=$(this),i=$(this).find(".page-scroll"),n=$(this).find(".page"),o=0,d=-1,s=!1,a={};t.on("dragstart",function(e){e.preventDefault()}).on("click",function(e){s&&(e.preventDefault(),e.stopPropagation())}).on("wheel",function(e){Math.abs(e.originalEvent.deltaX)&&e.preventDefault()});var l=n.length;if(!(l<=1)){t.addClass("pannable");var c=function(e){e<0||l<=e||e in a||(a[e]=!0,loadPage(n.eq(e)))},r=function(e,n,a){void 0===a&&(a=!0),void 0===n&&(n=!1),o=Math.max(0,Math.min((M+b)*(l-1),e)),i.toggleClass("animate-scroll",n).css("transform","translate3d("+-o+"px,0,0)");n=Math.round(o/M);d!=n&&(d=n,a&&(c(d-1),c(d),c(d+1)),g.find(".page-dot").each(function(e){$(this).toggleClass("active",e==d)}))},u=function(e){r(e*(M+b),!0)};this.snapToPage=u,this.getCurrentPage=function(){return d},$("<div>").addClass("edge-clicker prev").css("width",y).appendTo(t).click(function(){u(d-1)}),$("<div>").addClass("edge-clicker next").css("width",y).appendTo(t).click(function(){u(d+1)});function e(){u($(this).index())}for(var g=$("<div>").addClass("page-dots").appendTo(t),p=0;p<l;p++)g.append($("<div>").addClass("page-dot").click(e));var f,h,v,m=0,C=-1,w=!1;new Hammer(t.get(0),{dragLockToAxis:!0}).on("panend pan swipe",function(e){e.preventDefault(),e.srcEvent.preventDefault();var n,a;e.deltaX;switch(e.type){case"pan":w||(a=e.deltaX-m,s=!0,C<0&&(C=d),t.addClass("panning"),r(o-a),m=e.deltaX);break;case"swipe":w=!0,n=(m=0)==(e.direction&Hammer.DIRECTION_RIGHT),u(C+(n?1:-1)),setTimeout(function(){s=!1,C=-1,t.removeClass("panning")},0),e.srcEvent.stopPropagation();break;case"panend":w||(m=0,u(d),setTimeout(function(){s=!1,C=-1,t.removeClass("panning")},0)),w=!1}}),t.on("wheel",function(e){var n=e.originalEvent.deltaX<0?-1:1,a=Math.abs(e.originalEvent.deltaX);return a<Math.abs(e.originalEvent.deltaY)||(v||a<30?h=a:(h<a||n!=f)&&(f=n,v=!0,setTimeout(function(){v=!1},300),u(d+n)),!1)}),r(0,!1,!1)}})}function loadPage(e){}function playVideoMedia(e,n){e.data("should-be-playing",n);var a=e.find("video");n?e.hasClass("loaded")?a.get(0).play():(e.addClass("loading"),a.off("canplay").on("canplay",function(){e.addClass("loaded").removeClass("loading"),e.data("should-be-playing")&&a.get(0).play()}),a.get(0).load()):a.get(0).pause()}$(document).ready(function(){buildPagers(),setupMediaSizing(),setupVideoMedia(),setupFullscreen(),setupKeyboardNav(),FastClick.attach(document.body),$(".project a").attr("target","_blank")});